{"ast":null,"code":"import { ref, onMounted, reactive, computed } from 'vue';\nimport axios from 'axios';\nimport { useStore } from 'vuex';\nexport default {\n  __name: 'UserPurchases',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const store = useStore();\n    const purchases = ref([]);\n    const initialSearchFilters = {\n      factoryName: '',\n      minPrice: '',\n      maxPrice: '',\n      startDate: '',\n      endDate: ''\n    };\n    const initialSortOptions = {\n      sortBy: '',\n      sortOrder: 'asc' // 'asc' for ascending, 'desc' for descending\n    };\n    const searchFilters = reactive({\n      ...initialSearchFilters\n    });\n    const sortOptions = reactive({\n      ...initialSortOptions\n    });\n    const isCustomer = computed(() => store.getters.userRole === 'Customer');\n    onMounted(() => {\n      loadPurchases();\n    });\n    function loadPurchases() {\n      const userId = store.getters.userId;\n      const params = {\n        factoryName: searchFilters.factoryName || '',\n        minPrice: searchFilters.minPrice || '',\n        maxPrice: searchFilters.maxPrice || '',\n        startDate: searchFilters.startDate || '',\n        endDate: searchFilters.endDate || '',\n        sortBy: sortOptions.sortBy || '',\n        sortOrder: sortOptions.sortOrder || 'asc'\n      };\n      console.log('Loading purchases with params:', params);\n      axios.get(`http://localhost:3001/api/purchases/user/${userId}`, {\n        headers: {\n          'Authorization': `Bearer ${store.state.token}`\n        },\n        params\n      }).then(response => {\n        console.log('Purchases received:', response.data);\n        purchases.value = response.data;\n      }).catch(error => {\n        console.error('Error fetching purchases:', error);\n      });\n    }\n    function applyFiltersAndSort() {\n      loadPurchases();\n    }\n    function resetFilters() {\n      Object.assign(searchFilters, {\n        ...initialSearchFilters\n      });\n      Object.assign(sortOptions, {\n        ...initialSortOptions\n      });\n      loadPurchases();\n    }\n    function cancelPurchase(purchaseId) {\n      const userId = store.getters.userId;\n      axios.post('http://localhost:3001/api/purchases/cancel', {\n        purchaseId,\n        userId\n      }, {\n        headers: {\n          'Authorization': `Bearer ${store.state.token}`\n        }\n      }).then(response => {\n        console.log('Purchase canceled:', response.data);\n        loadPurchases();\n      }).catch(error => {\n        console.error('Error canceling purchase:', error);\n      });\n    }\n    function getFactoryName(purchase, chocolateId) {\n      if (!purchase || !purchase.factory) {\n        return 'Unknown Factory';\n      }\n      const factory = purchase.factory.find(f => f.chocolate && f.chocolate.id === chocolateId);\n      return factory ? factory.factoryName : 'Unknown Factory';\n    }\n    const __returned__ = {\n      store,\n      purchases,\n      initialSearchFilters,\n      initialSortOptions,\n      searchFilters,\n      sortOptions,\n      isCustomer,\n      loadPurchases,\n      applyFiltersAndSort,\n      resetFilters,\n      cancelPurchase,\n      getFactoryName,\n      ref,\n      onMounted,\n      reactive,\n      computed,\n      get axios() {\n        return axios;\n      },\n      get useStore() {\n        return useStore;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","reactive","computed","axios","useStore","store","purchases","initialSearchFilters","factoryName","minPrice","maxPrice","startDate","endDate","initialSortOptions","sortBy","sortOrder","searchFilters","sortOptions","isCustomer","getters","userRole","loadPurchases","userId","params","console","log","get","headers","state","token","then","response","data","value","catch","error","applyFiltersAndSort","resetFilters","Object","assign","cancelPurchase","purchaseId","post","getFactoryName","purchase","chocolateId","factory","find","f","chocolate","id"],"sources":["C:/Programiranje/veb/projekat/chocolate-factoryapp/Frontend/front-app/src/components/UserPurchases.vue"],"sourcesContent":["<template>\r\n  <div class=\"user-purchases\">\r\n    <h1>Your Purchases</h1>\r\n    \r\n    <!-- Search filters -->\r\n    <div class=\"search-filters\">\r\n      <div v-if=\"isCustomer\">\r\n        <label>Factory Name:</label>\r\n        <input v-model=\"searchFilters.factoryName\" type=\"text\" placeholder=\"Enter factory name\" >\r\n      </div>\r\n      \r\n      <label>Price Range:</label>\r\n      <input v-model=\"searchFilters.minPrice\" type=\"number\" placeholder=\"Min\">\r\n      <input v-model=\"searchFilters.maxPrice\" type=\"number\" placeholder=\"Max\">\r\n      \r\n      <label>Date Range:</label>\r\n      <input v-model=\"searchFilters.startDate\" type=\"date\">\r\n      <input v-model=\"searchFilters.endDate\" type=\"date\">\r\n      \r\n      <button @click=\"applyFiltersAndSort\">Apply Filters & Sort</button>\r\n      <button @click=\"resetFilters\">Reset Filters</button>\r\n    </div>\r\n\r\n    <!-- Sorting options -->\r\n    <div class=\"sorting-options\">\r\n      <label>Sort By:</label>\r\n      <select v-model=\"sortOptions.sortBy\">\r\n        <option value=\"\">Select</option>\r\n        <option value=\"factoryName\" v-if=\"isCustomer\">Factory Name</option>\r\n        <option value=\"totalPrice\">Total Price</option>\r\n        <option value=\"date\">Date</option>\r\n      </select>\r\n      <label>Order:</label>\r\n      <select v-model=\"sortOptions.sortOrder\">\r\n        <option value=\"asc\">Ascending</option>\r\n        <option value=\"desc\">Descending</option>\r\n      </select>\r\n    </div>\r\n\r\n    <!-- Purchases list -->\r\n    <div v-if=\"purchases.length\">\r\n      <div v-for=\"purchase in purchases\" :key=\"purchase.id\" class=\"purchase-item\">\r\n        <h3>Purchase ID: {{ purchase.id }}</h3>\r\n        <p>Date: {{ new Date(purchase.date).toLocaleString() }}</p>\r\n        <p>Total Price: {{ purchase.totalPrice }}</p>\r\n        <p>Status: {{ purchase.status }}</p>\r\n        <div v-for=\"item in purchase.chocolates\" :key=\"item.chocolate.id\" class=\"chocolate-item\">\r\n          <h4>{{ item.chocolate.name }}</h4>\r\n          <p>Quantity: {{ item.quantity }}</p>\r\n          <p>Price: {{ item.chocolate.price }}</p>\r\n          <p>Factory Name: {{ getFactoryName(purchase, item.chocolate.id) }}</p>\r\n        </div>\r\n        <div v-if=\"purchase.status === 'Odobreno' && purchase.factory && purchase.factory.length > 0\">\r\n          <router-link :to=\"{ name: 'AddComment', params: { factoryId: purchase.factory[0].chocolate.factoryId } }\">Add Comment</router-link>\r\n        </div>\r\n        <button v-if=\"purchase.status === 'Obrada'\" @click=\"cancelPurchase(purchase.id)\">Cancel</button>\r\n      </div>\r\n    </div>\r\n    <p v-else>You have no purchases.</p>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, reactive, computed } from 'vue';\r\nimport axios from 'axios';\r\nimport { useStore } from 'vuex';\r\n\r\nconst store = useStore();\r\nconst purchases = ref([]);\r\nconst initialSearchFilters = {\r\n  factoryName: '',\r\n  minPrice: '',\r\n  maxPrice: '',\r\n  startDate: '',\r\n  endDate: '',\r\n};\r\nconst initialSortOptions = {\r\n  sortBy: '',\r\n  sortOrder: 'asc', // 'asc' for ascending, 'desc' for descending\r\n};\r\nconst searchFilters = reactive({ ...initialSearchFilters });\r\nconst sortOptions = reactive({ ...initialSortOptions });\r\n\r\nconst isCustomer = computed(() => store.getters.userRole === 'Customer');\r\n\r\nonMounted(() => {\r\n  loadPurchases();\r\n});\r\n\r\nfunction loadPurchases() {\r\n  const userId = store.getters.userId;\r\n  const params = {\r\n    factoryName: searchFilters.factoryName || '',\r\n    minPrice: searchFilters.minPrice || '',\r\n    maxPrice: searchFilters.maxPrice || '',\r\n    startDate: searchFilters.startDate || '',\r\n    endDate: searchFilters.endDate || '',\r\n    sortBy: sortOptions.sortBy || '',\r\n    sortOrder: sortOptions.sortOrder || 'asc'\r\n  };\r\n\r\n  console.log('Loading purchases with params:', params);\r\n\r\n  axios.get(`http://localhost:3001/api/purchases/user/${userId}`, {\r\n    headers: {\r\n      'Authorization': `Bearer ${store.state.token}`\r\n    },\r\n    params\r\n  })\r\n    .then(response => {\r\n      console.log('Purchases received:', response.data);\r\n      purchases.value = response.data;\r\n    })\r\n    .catch(error => {\r\n      console.error('Error fetching purchases:', error);\r\n    });\r\n}\r\n\r\nfunction applyFiltersAndSort() {\r\n  loadPurchases();\r\n}\r\n\r\nfunction resetFilters() {\r\n  Object.assign(searchFilters, { ...initialSearchFilters });\r\n  Object.assign(sortOptions, { ...initialSortOptions });\r\n  loadPurchases();\r\n}\r\n\r\nfunction cancelPurchase(purchaseId) {\r\n  const userId = store.getters.userId;\r\n  axios.post('http://localhost:3001/api/purchases/cancel', { purchaseId, userId }, {\r\n    headers: {\r\n      'Authorization': `Bearer ${store.state.token}`\r\n    }\r\n  })\r\n    .then(response => {\r\n      console.log('Purchase canceled:', response.data);\r\n      loadPurchases();\r\n    })\r\n    .catch(error => {\r\n      console.error('Error canceling purchase:', error);\r\n    });\r\n}\r\n\r\nfunction getFactoryName(purchase, chocolateId) {\r\n  if (!purchase || !purchase.factory) {\r\n    return 'Unknown Factory';\r\n  }\r\n  const factory = purchase.factory.find(f => f.chocolate && f.chocolate.id === chocolateId);\r\n  return factory ? factory.factoryName : 'Unknown Factory';\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.user-purchases {\r\n  max-width: 800px;\r\n  margin: 0 auto;\r\n  padding: 20px;\r\n  background-color: #f5f5f5;\r\n  border-radius: 10px;\r\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.purchase-item {\r\n  margin: 20px 0;\r\n  padding: 10px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 8px;\r\n  background-color: #fff;\r\n  box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n}\r\n\r\n.chocolate-item {\r\n  margin-top: 10px;\r\n  padding: 5px;\r\n  border-top: 1px solid #eee;\r\n}\r\n\r\n.search-filters, .sorting-options {\r\n  margin-bottom: 20px;\r\n  padding: 15px;\r\n  background-color: #fff;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n}\r\n\r\n.search-filters label, .sorting-options label {\r\n  margin-right: 10px;\r\n  font-weight: bold;\r\n}\r\n\r\n.search-filters input, .search-filters select, .sorting-options select {\r\n  padding: 8px;\r\n  margin-right: 10px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 4px;\r\n  width: 150px;\r\n}\r\n\r\n.search-filters button {\r\n  padding: 8px 15px;\r\n  background-color: #007bff;\r\n  color: #fff;\r\n  border: none;\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n}\r\n\r\n.search-filters button:hover {\r\n  background-color: #0056b3;\r\n}\r\n\r\n.sorting-options select {\r\n  padding: 8px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 4px;\r\n  width: 150px;\r\n}\r\n\r\n.sorting-options label {\r\n  margin-right: 10px;\r\n  font-weight: bold;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}